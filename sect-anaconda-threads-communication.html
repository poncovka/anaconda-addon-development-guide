<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns:d="http://docbook.org/ns/docbook">4. Threads and Communication</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.2" /><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content="Fedora-Anaconda_Addon_Development_Guide-24-en-US-2-1" /><link rel="home" href="index.html" title="Anaconda Addon Development Guide" /><link rel="up" href="index.html" title="Anaconda Addon Development Guide" /><link rel="prev" href="sect-anaconda-hub-and-spoke.html" title="3. The Hub &amp; Spoke model" /><link rel="next" href="sect-anaconda-addon-structure.html" title="5. Anaconda Add-on Structure" /></head><body class="draft "><p id="title"><a class="left" href="http://www.fedoraproject.org"><img alt="Product Site" src="Common_Content/images//image_left.png" /></a><a class="right" href="http://docs.fedoraproject.org"><img alt="Documentation Site" src="Common_Content/images//image_right.png" /></a></p><ul class="docnav top"><li class="previous"><a accesskey="p" href="sect-anaconda-hub-and-spoke.html"><strong>Prev</strong></a></li><li class="home">Anaconda Addon Development Guide</li><li class="next"><a accesskey="n" href="sect-anaconda-addon-structure.html"><strong>Next</strong></a></li></ul><div class="section"><div class="titlepage"><div><div keep-together.within-column="always"><h2 class="title"><a id="sect-anaconda-threads-communication">
      ⁠</a>4. Threads and Communication</h2></div></div></div><div class="para">
			Some of the actions which need to be performed during the installation process, such as scanning disks for existing partitions or downloading package metadata, can take a long time. To prevent you from waiting and remain responsive if possible, <span class="application"><strong>Anaconda</strong></span> runs these actions in separate threads.
		</div><div class="para">
			The <span class="application"><strong>Gtk</strong></span> toolkit does not support element changes from multiple threads. The main event loop of <span class="application"><strong>Gtk</strong></span> runs in the main thread of the <span class="application"><strong>Anaconda</strong></span> process itself, and all code performing actions which involve the GUI must make sure that these actions are run in the main thread as well. The only supported way to do so is by using the <code class="methodname">GLib.idle_add</code>, which is not always easy or desired. To alleviate this problem, several helper functions and decorators are defined in the <span class="package">pyanaconda.ui.gui.utils</span> module.
		</div><div class="para">
			The most useful of those are the <code class="function">@gtk_action_wait</code> and <code class="function">@gtk_action_nowait</code> decorators. They change the decorated function or method in such a way that when this function or method is called, it is automatically queued into Gtk's main loop, run in the main thread, and the return value is either returned to the caller or dropped, respectively.
		</div><div class="para">
			As mentioned previously, one of the main reasons for using multiple threads is to allow the user to configure some screens while other screens which are currently busy (such as <span class="guilabel"><strong>Installation Source</strong></span> when it downloads package metadata) configure themselves. Once the configuration is finished, the spoke which was previously busy needs to announce that it is now ready and not blocked; this is handled by a message queue called <code class="systemitem">hubQ</code>, which is being periodically checked in the main event loop. When a spoke becomes accessible, it sends a message to this queue announcing this change and that it should no longer be blocked.
		</div><div class="para">
			The same applies in a situation where a spoke needs to refresh its status or completion flag. The <span class="guilabel"><strong>Configuration and Progress</strong></span> hub has a different queue called <code class="systemitem">progressQ</code> which serves as a medium to transfer installation progress updates.
		</div><div class="para">
			These mechanisms are also needed for the text-based interface, where the situation is more complicated; there is no main loop in text mode, instead the majority of time in this mode is spent waiting for keyboard input.
		</div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="sect-anaconda-hub-and-spoke.html"><strong>Prev</strong>3. The Hub &amp; Spoke model</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="sect-anaconda-addon-structure.html"><strong>Next</strong>5. Anaconda Add-on Structure</a></li></ul></body></html>